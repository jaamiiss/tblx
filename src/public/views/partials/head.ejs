<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>
    <%= title %>
  </title>
  <meta name="description" content="<%= process.env.SITE_DESCRIPTION || 'The Blacklist - Character Database' %>">
  <link rel="canonical"
    href="<%= typeof pageUrl !== 'undefined' ? pageUrl : (process.env.APP_URL || 'http://localhost:3006') %>">
  <link rel="icon" href="/assets/favicon.ico">

  <!-- Preload critical fonts -->
  <link rel="preload" href="/assets/fonts/Blacklisted.woff2" as="font" type="font/woff2" crossorigin>
  <link rel="preload" href="/assets/fonts/OCR%20A%20Std%20Regular.ttf" as="font" type="font/ttf" crossorigin>

  <!-- DNS prefetch for external resources -->
  <link rel="dns-prefetch" href="//cdn.jsdelivr.net">
  <link rel="dns-prefetch" href="//cdnjs.cloudflare.com">

  <!-- Critical CSS Strategy for List Page -->
  <% if (typeof includeListCSS !=='undefined' && includeListCSS) { %>
    <!-- Inline critical CSS for instant render -->
    <style>
      <%- include('../../assets/css/critical-list.css') %>
    </style>

    <!-- Load full CSS asynchronously -->
    <link rel="stylesheet" href="/assets/css/style.css?v=<%= Date.now() %>" media="print" onload="this.media='all'">

    <!-- Fallback for browsers without JS -->
    <noscript>
      <link rel="stylesheet" href="/assets/css/style.css?v=<%= Date.now() %>">
    </noscript>

    <!-- Ensure async CSS loads -->
    <script>
      !function () { "use strict"; var e = document.querySelector('link[media="print"]'); e && setTimeout(function () { e.media = "all" }, 0) }();
    </script>
    <% } else { %>
      <!-- Standard CSS loading for other pages -->
      <% if (process.env.NODE_ENV==='production' ) { %>
        <link rel="stylesheet" href="/assets/build/bundle.min.css?v=<%= Date.now() %>">
        <% } else { %>
          <link rel="stylesheet" href="/assets/css/style.css?v=<%= Date.now() %>">
          <% } %>
            <% } %>

              <!-- Structured Data (JSON-LD) -->
              <% if (typeof includeStructuredData !=='undefined' && includeStructuredData && typeof schemaData
                !=='undefined' && schemaData.length> 0) { %>
                <script type="application/ld+json">
  {
    "@context": "https://schema.org",
    "@type": "CollectionPage",
    "name": "<%= title %>",
    "description": "<%= process.env.SITE_DESCRIPTION || 'The Blacklist - Character Database' %>",
    "url": "<%= typeof pageUrl !== 'undefined' ? pageUrl : (process.env.APP_URL || 'http://localhost:3006') %>",
    "mainEntity": {
      "@type": "ItemList",
      "name": "<%= process.env.COLLECTION_NAME || 'The Blacklist Character Collection' %>",
      "numberOfItems": "<%= schemaData.length %>",
      "itemListElement": [
        <% schemaData.forEach((item, index) => { %>
        {
          "@type": "ListItem",
          "position": <%= index + 1 %>,
          "item": {
            "@type": "Person",
            "name": "<%= item.name %>",
            "identifier": "<%= item.v1 %>"
          }
        }<%= index < schemaData.length - 1 ? ',' : '' %>
        <% }); %>
      ]
    }
  }
  </script>
                <% } %>

                  <% if (process.env.NODE_ENV==='production' ) { %>
                    <script src="/assets/build/core.min.js?v=<%= Date.now() %>" defer></script>
                    <% } else { %>
                      <script src="/assets/js/vendor/htmx.min.js" defer></script>
                      <script src="/assets/js/core/index.js" defer></script>
                      <% if (typeof includeItemRenderer !=='undefined' && includeItemRenderer) { %>
                        <script src="/assets/js/item-renderer.js?v=<%= Date.now() %>" defer></script>
                        <% } %>
                          <% } %>
</head>